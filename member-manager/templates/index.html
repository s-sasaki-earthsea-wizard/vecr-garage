{% extends "base.html" %}

{% block title %}ホーム - VECR Member Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="jumbotron bg-light p-5 rounded">
            <h1 class="display-4">
                <i class="fas fa-users me-3"></i>VECR Garage Member Manager
            </h1>
            <p class="lead">メンバー管理システムへようこそ</p>
            <hr class="my-4">
            <p>現在はモックアップ版ですが、将来的にはデータベースと連携して動的にデータを表示します。</p>
            <div class="d-flex gap-2">
                <a class="btn btn-primary btn-lg" href="{{ url_for('get_database_tables') }}">
                    <i class="fas fa-database me-2"></i>データベース管理
                </a>
                <button class="btn btn-outline-secondary btn-lg" onclick="showMockData()">
                    <i class="fas fa-eye me-2"></i>モックデータ表示
                </button>
            </div>
        </div>
    </div>
</div>

<!-- モックデータ表示セクション -->
<div class="row" id="mockDataSection" style="display: none;">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-table me-2"></i>モックデータ
                </h5>
            </div>
            <div class="card-body">
                <!-- テーブル選択 -->
                <div class="mb-3">
                    <label for="tableSelect" class="form-label">テーブル選択:</label>
                    <select id="tableSelect" class="form-select" onchange="loadMockTable()">
                        <option value="">-- テーブルを選択してください --</option>
                        {% for table in tables %}
                        <option value="{{ table }}">{{ table }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- データ表示エリア -->
                <div id="dataSection" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 id="tableName" class="mb-0"></h6>
                        <button id="addRecordBtn" class="btn btn-sm btn-primary" onclick="showAddRecordModal()">
                            <i class="fas fa-plus me-1"></i>新規レコード追加
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="dataTable" class="table table-striped table-hover">
                            <thead id="tableHead" class="table-dark">
                                <!-- JavaScriptで動的に生成 -->
                            </thead>
                            <tbody id="tableBody">
                                <!-- JavaScriptで動的に生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 新規レコード追加モーダル -->
<div class="modal fade" id="addRecordModal" tabindex="-1">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">新規レコード追加</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <form id="addRecordForm">
                <!-- JavaScriptで動的に生成 -->
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="saveRecord()">保存</button>
        </div>
    </div>
</div>

<!-- 編集モーダル -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">レコード編集</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <form id="editForm">
                <!-- JavaScriptで動的に生成 -->
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="updateRecord()">更新</button>
        </div>
    </div>
</div>

<!-- 削除確認モーダル -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">削除確認</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <p>このレコードを削除してもよろしいですか？</p>
            <p id="deleteInfo" class="text-muted"></p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-danger" onclick="confirmDelete()">削除</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// モックデータ表示の切り替え
function showMockData() {
    const section = document.getElementById('mockDataSection');
    if (section.style.display === 'none') {
        section.style.display = 'block';
        document.querySelector('button[onclick="showMockData()"]').textContent = 'モックデータ非表示';
    } else {
        section.style.display = 'none';
        document.querySelector('button[onclick="showMockData()"]').textContent = 'モックデータ表示';
    }
}

// モックテーブルの読み込み
function loadMockTable() {
    const tableSelect = document.getElementById('tableSelect');
    const tableName = tableSelect.value;
    
    if (!tableName) {
        document.getElementById('dataSection').style.display = 'none';
        return;
    }
    
    // モックデータからテーブル情報を取得
    fetch(`/api/table/${tableName}`)
        .then(response => response.json())
        .then(data => {
            if (data.data) {
                displayMockTable(data.data);
            }
        })
        .catch(error => {
            console.error('テーブル読み込みエラー:', error);
        });
}

// モックテーブルの表示
function displayMockTable(tableData) {
    const dataSection = document.getElementById('dataSection');
    const tableName = document.getElementById('tableName');
    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    
    tableName.textContent = tableData.table_name || 'テーブル';
    dataSection.style.display = 'block';
    
    // ヘッダー行の生成
    if (tableData.columns && tableData.columns.length > 0) {
        let headerHtml = '<tr>';
        tableData.columns.forEach(column => {
            headerHtml += `<th>${column}</th>`;
        });
        headerHtml += '<th>操作</th></tr>';
        tableHead.innerHTML = headerHtml;
    }
    
    // データ行の生成
    if (tableData.data && tableData.data.length > 0) {
        let bodyHtml = '';
        tableData.data.forEach((row, index) => {
            bodyHtml += '<tr>';
            Object.values(row).forEach(value => {
                bodyHtml += `<td>${value !== null ? value : '<span class="text-muted">NULL</span>'}</td>`;
            });
            bodyHtml += `
                <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editRecord('${tableData.table_name}', ${index})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteRecord('${tableData.table_name}', ${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>`;
        });
        tableBody.innerHTML = bodyHtml;
    } else {
        tableBody.innerHTML = '<tr><td colspan="100%" class="text-center text-muted">データがありません</td></tr>';
    }
}

// レコード編集
function editRecord(tableName, index) {
    // 編集モーダルの表示ロジック
    console.log('編集:', tableName, index);
}

// レコード削除
function deleteRecord(tableName, index) {
    // 削除確認モーダルの表示ロジック
    console.log('削除:', tableName, index);
}

// 新規レコード追加
function showAddRecordModal() {
    // 新規追加モーダルの表示ロジック
    console.log('新規追加');
}

// レコード保存
function saveRecord() {
    // 新規レコードの保存ロジック
    console.log('保存');
}

// レコード更新
function updateRecord() {
    // レコードの更新ロジック
    console.log('更新');
}

// 削除確認
function confirmDelete() {
    // レコードの削除ロジック
    console.log('削除確認');
}
</script>
{% endblock %}